<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Zero's Blog | iOS学习日志"><title>Runtime：Class &amp; metaclass | Command+R</title><link rel="stylesheet" type="text/css" href="/css/highlight/highlight.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Runtime：Class &amp; metaclass</h1><a id="logo" href="/.">Command+R</a><p class="description">Life doesn't have a ctrl-z. Type wisely.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/categories/"><i class="fa fa-folder"> 分类</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Runtime：Class &amp; metaclass</h1><div class="post-meta">Sep 25, 2015<span> | </span><span class="category"><a href="/categories/iOS/">iOS @ </a><a href="/categories/iOS/Objc/">Objc @ </a><a href="/categories/iOS/Objc/Runtime/">Runtime</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#about"><span class="toc-number">1.</span> <span class="toc-text">about</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#class"><span class="toc-number">2.</span> <span class="toc-text">class</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#metaclass"><span class="toc-number">3.</span> <span class="toc-text">metaclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#metaclass's_Class_isa"><span class="toc-number">4.</span> <span class="toc-text">metaclass's Class isa</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#metaclass‘s_super_class"><span class="toc-number">5.</span> <span class="toc-text">metaclass‘s super_class</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#end"><span class="toc-number">6.</span> <span class="toc-text">end</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="post-content"><h1 id="about">about</h1><p>关于class结构：<br><a href="http://opensource.apple.com/source/objc4/objc4-647/runtime/objc.h" target="_blank" rel="external">/runtime/objc.h</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// An opaque type that represents an Objective-C class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_cache *cache                                 OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">/* Use `Class` instead of `struct objc_class *` */</span></span><br></pre></td></tr></table></figure>
<p>之前学习过了，Class类型的表示是一个指向objc_class结构体的指针，objc_class结构体存储了描述类的对象的所有信息。<br>有趣的是：这个类结构体的第一个数据居然是指向另一个Class的isa指针。</p>
<p>对象的<code>Class isa</code>是为了找到其说明书：Class所在的位置。<br>那么类的<code>Class isa</code>又是干什么的。<br>事实是：类也是对象</p>
<h1 id="class">class</h1><p>每个Objective-C的类也是一个对象，类也有isa指针，也可以响应消息。</p>
<p>在方法定义时的<code>+</code>(加号)表示定义的正是类方法。如<code>[NSObject alloc]</code>就是向类发送一条消息;事实上，最常见的<code>alloc</code>什么的就是类方法：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> object = [[<span class="built_in">NSObject</span> alloc]init];</span><br></pre></td></tr></table></figure></p>
<p>我们是向NSObject类发送的消息，而不是对象。<br>那问题来了，<strong>之前说对象代表一个类的实例；既然类也是对象，它是什么的实例呢？</strong><br>另外，<strong>类解释对象的数据，持有对象的方法；既然类也有方法，那么类的方法被什么持有呢？</strong></p>
<p>答案是：Class是metaclass的实例,metaclass持有类方法。</p>
<h1 id="metaclass">metaclass</h1><blockquote>
<p>The compiler also builds a ``meta-class object&#39;&#39; for each class. It describes the class object just as the class object describes instances of the class. But while you can send messages to instances and to the class object, the meta-class object is used only internally by the run-time system.</p>
</blockquote>
<p>对象和类通过<code>Class isa</code>指针，在概念上神奇地相同了。同为对象。<br>metaclass 是类对象的类,由runtime system创建及维护。它拥有和其他类一样的数据结构，也是<code>struct objc_class</code>也有isa，super_class,方法列表。</p>
<p>正如类描述了对象；metaclass（元类）描述了类。<br>正如类为对象描述了实例方法；同理：metaclass元类的方法列表描述的正是类的类方法。<br>正如当向对象发送消息时<code>objc_msgSend</code>查找类的方法列表（实例方法）以决定方法调用；同理：当向类发送消息时，<code>objc_msgSend</code>查找metaclass的方法列表（类方法）以决定方法调用。</p>
<p>在<a href="/2015/09/04/iOS/Objective-C/runtime/iOS_objc_runtime_compiler/#语义分析（Semantic_Analysis），运行时支持">关于compiler的笔记</a>中，有这样一个关于编译器会为方法声明添加2个隐藏参数的例子，现在在来重新看一下：<br>首先，编译器会对消息传递进行objc_msgSend改写，会为方法声明添加2个隐藏参数：</p>
<ol>
<li>self  代表当前消息的接收者</li>
<li>_cmd  代表当前消息的selector</li>
</ol>
<p>如下例：给NSObject增加2个方法：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span>(<span class="title">MyObject</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>)sayHello;</span><br><span class="line">+ (<span class="keyword">void</span>)sayHello;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span></span></span><br><span class="line">- (<span class="keyword">void</span>)sayHello&#123;&#125;;</span><br><span class="line">+ (<span class="keyword">void</span>)sayHello&#123;&#125;;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>使用命令<code>clang -Xclang -ast-dump main.m</code>后可以看到：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">|-ObjCCategoryDecl <span class="number">0x1055d20c0</span> &lt;main.m:<span class="number">15</span>:<span class="number">1</span>, line:<span class="number">20</span>:<span class="number">2</span>&gt; line:<span class="number">15</span>:<span class="number">12</span> MyObject</span><br><span class="line">| |-ObjCInterface <span class="number">0x1033ab3b0</span> <span class="string">'NSObject'</span></span><br><span class="line">| |-ObjCCategoryImpl <span class="number">0x1055d2290</span> <span class="string">'NSObject'</span></span><br><span class="line">| |-ObjCMethodDecl <span class="number">0x1055d2160</span> &lt;line:<span class="number">17</span>:<span class="number">1</span>, col:<span class="number">17</span>&gt; col:<span class="number">1</span> - sayHello <span class="string">'void'</span></span><br><span class="line">| <span class="string">`-ObjCMethodDecl 0x1055d2200 &lt;line:18:1, col:17&gt; col:1 + sayHello 'void'</span><br><span class="line">|-ObjCCategoryImplDecl 0x1055d2290 &lt;line:22:1, line:33:1&gt; line:22:17 NSObject</span><br><span class="line">| |-ObjCInterface 0x1033ab3b0 'NSObject'</span><br><span class="line">| |-ObjCCategory 0x1055d20c0 'MyObject'</span><br><span class="line">| |-ObjCMethodDecl 0x1055d2310 &lt;line:24:1, line:26:1&gt; line:24:1 - sayHello 'void'</span><br><span class="line">| | |-ImplicitParamDecl 0x1055d2440 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit self 'NSObject *'</span><br><span class="line">| | |-ImplicitParamDecl 0x1055d24a0 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit _cmd 'SEL':'SEL *'</span><br><span class="line">| | `</span>-CompoundStmt <span class="number">0x1055d24f8</span> &lt;col:<span class="number">17</span>, line:<span class="number">26</span>:<span class="number">1</span>&gt;</span><br><span class="line">| <span class="string">`-ObjCMethodDecl 0x1055d23b0 &lt;line:28:1, line:30:1&gt; line:28:1 + sayHello 'void'</span><br><span class="line">|   |-ImplicitParamDecl 0x1055d2510 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit self 'Class':'Class'</span><br><span class="line">|   |-ImplicitParamDecl 0x1055d2570 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit _cmd 'SEL':'SEL *'</span><br><span class="line">|   `</span>-CompoundStmt <span class="number">0x1055d25c8</span> &lt;col:<span class="number">17</span>, line:<span class="number">30</span>:<span class="number">1</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>仔细看一下：<br>在9-11行，NSObject实例方法<code>- (void)sayHello</code>增添的两个隐藏参数是：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implicit self <span class="string">'NSObject *'</span></span><br><span class="line">implicit _cmd <span class="string">'SEL'</span>:<span class="string">'SEL *'</span></span><br></pre></td></tr></table></figure></p>
<p>在13-15行，NSObject类方法<code>+ (void)sayHello</code>增添的两个隐藏参数是：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implicit self <span class="string">'Class'</span>:<span class="string">'Class'</span></span><br><span class="line">implicit _cmd <span class="string">'SEL'</span>:<span class="string">'SEL *'</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到:<br>NSObject中实例方法<code>- (void)sayHello</code>：</p>
<ul>
<li>其消息接收者——<code>self</code>是<code>NSObject*</code> 是指向NSObject对象的指针，即实例对象。</li>
<li>方法<code>- (void)sayHello</code>的信息和实现被NSObject Class持有。</li>
<li>NSObject object收到消息后，通过对象结构中的<code>Class isa</code>找到NSObject Class搜索方法列表。</li>
</ul>
<p>NSObject中类方法<code>+ (void)sayHello</code>：</p>
<ul>
<li>NSObject类方法消息接收者——<code>self</code>是<code>Class</code>,这个<code>Class</code>是NSObject类对象，是NSObject-metaclass的实例。</li>
<li>方法<code>+ (void)sayHello{};</code>的信息和实现被NSObject的metaclass持有。</li>
<li>NSObject Class收到消息后，通过类结构中的<code>Class isa</code>找到metaclass搜索方法列表。</li>
</ul>
<h1 id="metaclass&#39;s_Class_isa">metaclass&#39;s <code>Class isa</code></h1><p>刚才已经说了metaclass 是类对象的类,拥有和其他类一样的数据结构，也是<code>struct objc_class</code>：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_cache *cache                                 OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">/* Use `Class` instead of `struct objc_class *` */</span></span><br></pre></td></tr></table></figure></p>
<p>那么metaclass又有一个<code>Class isa</code>，这意味着，其实meta-class也是一个对象。那么问题来了，<strong>无止境了吗？</strong><br>鉴于<code>Class isa</code>其实是用来描述对象的数据信息和方法的。我们要用到对象，实例方法，要用到类，类方法，但是元类的信息和方法我们用不到也不存在，它只是被runtime利用和维护。所以元类的信息其实我们并不关心。<br>鉴于此，基类的metaclass的isa指向自己来完成闭环。这里说的是<strong>基类</strong>而不是<strong>父类</strong>。</p>
<p>看看runtime源码：</p>
<p><a href="http://opensource.apple.com/source/objc4/objc4-647/runtime/objc-runtime-new.h" target="_blank" rel="external">/runtime/objc-runtime-new.h</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isMetaClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assert(<span class="keyword">this</span>);</span><br><span class="line">    assert(isRealized());</span><br><span class="line">    <span class="keyword">return</span> data()-&gt;ro-&gt;flags &amp; RO_META;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// NOT identical to this-&gt;ISA when this is a metaclass</span></span><br><span class="line"><span class="function">Class <span class="title">getMeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isMetaClass()) <span class="keyword">return</span> (Class)<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>-&gt;ISA();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRootClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> superclass == nil;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRootMetaclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ISA() == (Class)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>什么是根元类：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRootMetaclass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ISA() == (Class)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>元类是自己的就是根元类。这就是：<em>基类的metaclass的isa指向自己来完成闭环</em><br>结合代码，再引用一篇博客中看到的图：<br><img id="fancybox" src="/img/class_metaclass.png"></p>
<h1 id="metaclass‘s_super_class">metaclass‘s super_class</h1><p>鉴于metaclass也是<code>struct objc_class</code>，metaclass的<code>struct objc_class</code>中的superclass也和类，对象的superclass一样用于指向其超类。<br>然而，看了上面的代码和上图之后有点疑惑：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRootClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> superclass == nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果没有超类，则是根类。<br>NSObject的超类指向nil，其是根类；<br>按理说NSObject的metaclass的应该是超级根类（元根类）啊，而为什么其superclass不但不是nil，还指向NSObject呢？</p>
<p>试想：NSObject作为继承链上的基类，定义了Objective-C对象所必须的共有行为：如内存管理，等等。<br>还记得吗。实例对象是对象，类对象是对象，metaclass也是对象，意思是metaclass在一定程度上也需要这些作为对象的基本能力。<br>对象的这些基本行为中的实例方法描述在NSObject中，类方法描述在NSObject’s metaclass中；NSObject’s metaclass作为对象的基本行为也应该是从NSObject’s metaclass‘s metaclass来获取吗？然而并不是！因为上文已经说了：NSObject’s metaclass‘s metaclass是它自己，它自己没有这些信息。怎么办呢？<br>它采取了继承自NSObject这样的一个简单的方式，其结果是NSObject‘s metaclass同所有Objective-C对象一样都是从NSObject根类中获取自己作为对象的基本能力。<br>所以，可以肯定的是，在Mach-O中的<code>__OBJC segment</code>中，NSObject是作为对象的一个基本的存在。<br>这也正好解释了NSObject的重要性和为什么我们的对象基本都要继承自NSObject。</p>
<p>NSObject’s metaclass的superclass指向NSObject的结果是：<br><em>NSObject的继承链下，所有对象，类，元类都可以响应NSObject的实例方法。</em><br>因为，当进行方法查找时：</p>
<ul>
<li>对象：isa到NSOject查找，bingo</li>
<li>类：isa到NSObject’s metaclass查找，找不到，追溯到superclass——NSObject，bingo</li>
<li>metaclass：isa到了自己，找不到，追溯到superclass——NSObject，bingo</li>
</ul>
<p><em>NSObject的继承链下，所有类，元类都可以响应NSObject的类方法。</em><br>因为，当进行方法查找时：</p>
<ul>
<li>类：isa到NSObject’s metaclass查找，bingo</li>
<li>metaclass：isa到了自己，bingo</li>
</ul>
<h1 id="end">end</h1><p>就一句话：<br>实例对象是对象，类对象是对象，metaclass也是对象。</p>
<h1 id="参考资料">参考资料</h1><p><a href="http://opensource.apple.com/source/objc4/objc4-647/runtime/objc" target="_blank" rel="external">/runtime/objc-Source</a><br><a href="http://www.cocoawithlove.com/2010/01/what-is-meta-class-in-objective-c.html" target="_blank" rel="external">what-is-meta-class-in-objective-c</a><br><a href="http://www.sealiesoftware.com/blog/archive/2009/04/14/objc_explain_Classes_and_metaclasses.html" target="_blank" rel="external">Classes and metaclasses</a></p>
</div><a data-url="http://www.hitlolo.com/2015/09/25/iOS/Objective-C/runtime/iOS_objc_runtime_class_metaclass/" data-id="cipuydq6l001vlshtpjbv6tkd" class="article-share-link">分享到</a><div class="tags"><a href="/tags/metaclass/">metaclass</a><a href="/tags/runtime/">runtime</a></div><div class="post-nav"><a href="/2015/10/15/iOS/Objective-C/runtime/iOS_objc_runtime_self_super/" class="pre">Runtime：self &amp; super</a><a href="/2015/09/24/iOS/UIKit/Interface Builder/iOS_UIKit_interfacebuilde_controller_and_view/" class="next">正确姿势:分离[ 结构 ]与 [ UI ]</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Foundation/">Foundation</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Foundation/NSObject/">NSObject</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Objc/">Objc</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Objc/Runtime/">Runtime</a><span class="category-list-count">7</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/UIKit/">UIKit</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/UIKit/Interface-Builder/">Interface Builder</a><span class="category-list-count">3</span></li></ul></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/compiler/" style="font-size: 15px;">compiler</a> <a href="/tags/storyboard/" style="font-size: 15px;">storyboard</a> <a href="/tags/self/" style="font-size: 15px;">self</a> <a href="/tags/super/" style="font-size: 15px;">super</a> <a href="/tags/dyld/" style="font-size: 15px;">dyld</a> <a href="/tags/runtime/" style="font-size: 15px;">runtime</a> <a href="/tags/class/" style="font-size: 15px;">class</a> <a href="/tags/object/" style="font-size: 15px;">object</a> <a href="/tags/metaclass/" style="font-size: 15px;">metaclass</a> <a href="/tags/NSObject/" style="font-size: 15px;">NSObject</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 快速通道</i></div><ul></ul><a href="https://developer.apple.com/library" title="Apple Dev" target="_blank">Apple Dev</a><ul></ul><a href="http://stackoverflow.com/" title="StackOverflow" target="_blank">StackOverflow</a><ul></ul><a href="http://www.cocoawithlove.com/" title="CocoaWithLove" target="_blank">CocoaWithLove</a><ul></ul><a href="https://www.mikeash.com/" title="MikeAsh" target="_blank">MikeAsh</a><ul></ul><a href="http://nshipster.com/" title="NSHipster" target="_blank">NSHipster</a><ul></ul><a href="https://www.objc.io/" title="Objc" target="_blank">Objc</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Command+R.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/share.js?v=0.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>